<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>gawk with WebAssembly</title>
</head>
<body>
    <h1>gawk with WebAssembly Demo</h1>
    <pre id="output"></pre> <!-- Element to display output -->
    <script src="gawk.js"></script> <!-- Load the JavaScript wrapper -->
    <script>
        // Load the WebAssembly module
        fetch('gawk.wasm').then(response =>
            response.arrayBuffer()
        ).then(buffer =>
            WebAssembly.instantiate(buffer, {
                env: {
                    // Define any imports or environment settings if needed
                }
            })
        ).then(result => {
            const gawkModule = result.instance.exports;

            // Example input data and AWK script
            const inputData = "name,age\nJohn,30\nDoe,25";
            const awkScript = 'BEGIN { FS = "," } { print $1 " is " $2 " years old" }';

            // Use FileSystem API to pass input and script to gawk
            Module.FS.writeFile('/input.txt', inputData);
            Module.FS.writeFile('/script.awk', awkScript);

            // Call the main function from gawk (WebAssembly exports)
            gawkModule.main(['gawk', '-f', '/script.awk', '/input.txt'].length, ['gawk', '-f', '/script.awk', '/input.txt']);

            // Read output file from the FS
            const output = Module.FS.readFile('/output.txt', { encoding: 'utf8' });
            document.getElementById('output').textContent = output;
        }).catch(console.error);
    </script>
</body>
</html>
