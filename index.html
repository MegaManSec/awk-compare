<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWK Comparison</title>
    <style>
        @import url("css.css");
    </style>
</head>
<body>
    <header>AWK Comparison Tool</header>
    <div class="main-container">
        <!--<div class="options-container">
            <label for="autoCompile">Auto Compile</label>
            <input type="checkbox" id="autoCompile" checked>
            
            <button>Create a Persistent Link</button>
        </div>-->

        <div class="output-container">
            <div class="output-sections">
                <div class="output-section">
                    <div class="output-header gawk-header">gawk</div>
                    <pre id="gawkOutput"> </pre>
                </div>
                <div class="output-section">
                    <div class="output-header mawk-header">mawk</div>
                    <pre id="mawkOutput"> </pre>
                </div>
                <div class="output-section">
                    <div class="output-header mawk-old-header">mawk-1.3.3</div>
                    <pre id="mawk-1.3.3Output"> </pre>
                </div>
                <div class="output-section">
                    <div class="output-header original-awk-header">awk</div>
                    <pre id="awkOutput"> </pre>
                </div>
            </div>

            <div class="input-container">
                <div class="input-section">
                    <div class="input-header">AWK Script</div>
                    <textarea id="awkScript" rows="10" placeholder="Enter your AWK script..."></textarea>
                </div>
                <div class="input-section">
                    <div class="input-header">Data</div>
                    <textarea id="awkData" rows="10" placeholder="Enter your data..."></textarea>
                    <button onclick="runAWK()">Run AWK</button>
                </div>
            </div>
        </div>
    </div>

    <div id="iframeContainer"></div>

    <script>
        const awkVariants = ['mawk', 'mawk-1.3.3', 'gawk', 'awk'];
        async function runAWK() {
            const script = document.getElementById('awkScript').value;
            const data = document.getElementById('awkData').value;

            for (const variant of awkVariants) {
              document.getElementById(`${variant}Output`).textContent = '';
              const iframe = document.createElement('iframe');
              iframe.id = `${variant}Frame`;
              iframe.src = `awk/index.html`;
              iframe.style.display = 'none';
              document.getElementById('iframeContainer').appendChild(iframe);
              iframe.onload = () => {
                  const message = { variant, script, data };
                  document.getElementById(`${variant}Frame`).contentWindow.postMessage(message, '*');
              };
            }
        }

        window.addEventListener('message', (event) => {
          if (event.origin !== window.location.origin) return;

          const { outputId, output } = event.data;

          if (outputId && output !== undefined) {
            document.getElementById(outputId).textContent += output + "\n";

            const variant = outputId.replace('Output', '');
            const iframeToRemove = document.getElementById(`${variant}Frame`);
            if (iframeToRemove) {
              iframeToRemove.remove();
            }
          }
        });
    </script>
</body>
</html>
